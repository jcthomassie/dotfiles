---
version: 0.2.0

repo:
  local: ~/dotfiles
  remote: https://github.com/jcthomassie/dotfiles.git

shell: zsh

build:
  - case:
    - positive:
        spec: { distro: ubuntu }
        include:
          - require: [ apt, apt-get ]
          - matrix:
              values:
                package: [ build-essential, libssl-dev, pkg-config ]
              include:
                - install:
                  - name: ${{ matrix.package }}
                    managers: [ apt ]
    # Windows only
    - positive:
        spec: { platform: windows }
        include:
          - require: [ choco ]
          - link:
            - tail: ${{ repo.local }}/pwsh/profile.ps1
              head: ~/Documents/WindowsPowerShell/Microsoft.PowerShell_profile.ps1
            - tail: ${{ repo.local }}/.wt.json
              head: ${{ env.LocalAppData }}/Packages/Microsoft.WindowsTerminal_8wekyb3d8bbwe/LocalState/settings.json
            - tail: ${{ repo.local }}/python/.flake8
              head: ~/.flake8
    # Posix only
    - negative:
        spec: { platform: windows }
        include:
          - require: [ brew ]
          - run: brew bundle --file ${{ repo.local }}/.brewfile
          - install:
            - name: zsh
              managers: [ brew, apt-get ]
            - name: exa
              managers: [ brew, apt, cargo ]
          - link:
            - tail: ${{ repo.local }}/zsh/.zshenv
              head: ~/.zshenv
            - tail: ${{ repo.local }}/python/.flake8
              head: ~/.config/flake8

  # Bootstrap package managers
  - require: [ cargo ]

  # Install essential packages
  - install:
    - name: git
      managers: [ brew, choco ]
    - name: delta
      alias: git-delta
      managers: [ brew, choco, cargo ]
    - name: bat
      managers: [ brew, choco, cargo, apt ]
    - name: vim
      managers: [ brew, choco ]
    - name: gh
      managers: [ brew, choco ]
    - name: zoxide
      managers: [ brew, choco, cargo ]

  # Apply symlinks
  - matrix:
      values:
        tail:
          - .vimrc
          - git/.gitconfig
          - git/.gitignore_global
          - python/.mypy.ini
          - python/.isort.cfg
        head:
          - ~/.vimrc
          - ~/.gitconfig
          - ~/.gitignore_global
          - ~/.mypy.ini
          - ~/.isort.cfg
      include:
        - link:
          - tail: ${{ repo.local }}/${{ matrix.tail }}
            head: ${{ matrix.head }}

  # Amazon specifics
  - case:
    - positive:
        spec: { user: thomajl }
        include:
          - link:
            - tail: ${{ repo.local }}/git/.gitconfig.local##user.thomajl
              head: ~/.gitconfig.local
    - default:
        include:
          - link:
            - tail: ${{ repo.local }}/git/.gitconfig.local##default
              head: ~/.gitconfig.local
