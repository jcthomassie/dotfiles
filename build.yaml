---
version: 0.2.0

repo:
  local: ~/dotfiles
  remote: https://github.com/jcthomassie/dotfiles.git

shell: zsh

build:
  - case:
    - positive:
        spec: { distro: ubuntu }
        include:
          - install:
            - name: build-essential
              managers: [ apt ]
            - name: libssl-dev
              managers: [ apt ]
            - name: pkg-config
              managers: [ apt ]
    # Windows only
    - positive:
        spec: { platform: windows }
        include:
          - bootstrap: [ choco ]
          - link:
            - tail: ${{ repo.local }}/pwsh/profile.ps1
              head: ~/Documents/WindowsPowerShell/Microsoft.PowerShell_profile.ps1
            - tail: ${{ repo.local }}/.wt.json
              head: ${{ env.LocalAppData }}/Packages/Microsoft.WindowsTerminal_8wekyb3d8bbwe/LocalState/settings.json
            - tail: ${{ repo.local }}/python/.flake8
              head: ~/.flake8
    # Posix only
    - negative:
        spec: { platform: windows }
        include:
          - bootstrap: [ brew ]
          - run: brew bundle --file ${{ repo.local }}/.brewfile
          - install:
            - name: zsh
              managers: [ brew, apt-get ]
            - name: exa
              managers: [ brew, apt, cargo ]
          - link:
            - tail: ${{ repo.local }}/zsh/.zshenv
              head: ~/.zshenv
            - tail: ${{ repo.local }}/python/.flake8
              head: ~/.config/flake8

  # Bootstrap package managers
  - bootstrap: [ cargo ]

  # Install essential packages
  - install:
    - name: git
      managers: [ brew, choco ]
    - name: delta
      alias: git-delta
      managers: [ brew, cargo, choco ]
    - name: bat
      managers: [ brew, choco, cargo, apt ]
    - name: vim
      managers: [ brew, choco ]
    - name: gh
      managers: [ brew, choco ]
    - name: zoxide
      managers: [ brew, choco ]

  # Apply symlinks
  - link:
    - tail: ${{ repo.local }}/git/.gitconfig
      head: ~/.gitconfig
    - tail: ${{ repo.local }}/git/.gitignore_global
      head: ~/.gitignore_global
    - tail: ${{ repo.local }}/.vimrc
      head: ~/.vimrc
    - tail: ${{ repo.local }}/python/.mypy.ini
      head: ~/.mypy.ini
    - tail: ${{ repo.local }}/python/.isort.cfg
      head: ~/.isort.cfg

  # Amazon specifics
  - case:
    - positive:
        spec: { user: thomajl }
        include:
          - link:
            - tail: ${{ repo.local }}/git/.gitconfig.local##user.thomajl
              head: ~/.gitconfig.local
    - default:
        include:
          - link:
            - tail: ${{ repo.local }}/git/.gitconfig.local##default
              head: ~/.gitconfig.local
